<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<body>
<div th:fragment="content">

  <form method="get" action="/admin/audits" class="row g-2 align-items-end">
    <div class="col-12 col-md-3">
      <label class="form-label">Action</label>
      <input class="form-control" name="action" placeholder="예: LOGIN_FAIL"
             th:value="${action}">
    </div>

    <div class="col-12 col-md-3">
      <label class="form-label">Target Type</label>
      <select class="form-select" name="targetType">
        <option value="" th:selected="${targetType == null or targetType == ''}">전체</option>
        <option value="AUTH" th:selected="${targetType == 'AUTH'}">AUTH</option>
        <option value="USER" th:selected="${targetType == 'USER'}">USER</option>
        <option value="CATEGORY" th:selected="${targetType == 'CATEGORY'}">CATEGORY</option>
        <option value="PRODUCT" th:selected="${targetType == 'PRODUCT'}">PRODUCT</option>
      </select>
    </div>

    <div class="col-12 col-md-2">
      <label class="form-label">Target ID</label>
      <input class="form-control" name="targetId" type="number" min="0"
             th:value="${targetId}">
    </div>

    <div class="col-12 col-md-2">
      <label class="form-label">Actor ID</label>
      <input class="form-control" name="actorId" type="number" min="0"
             th:value="${actorId}">
    </div>

    <div class="col-12 col-md-2 d-grid">
      <button class="btn btn-primary" type="submit">검색</button>
    </div>
  </form>

  <hr class="my-3"/>

  <div class="table-responsive">
    <table class="table table-sm table-striped align-middle">
      <thead>
      <tr>
        <th>ID</th>
        <th>시간</th>
        <th>Action</th>
        <th>Actor</th>
        <th>Target</th>
        <th>IP</th>
        <th>User-Agent</th>
        <th>Diff</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="log : ${result.content}">
        <td th:text="${log.id}"></td>
        <td th:text="${#temporals.format(log.createdAt,'yyyy-MM-dd HH:mm:ss')}"></td>
        <td>
        <span class="badge text-bg-secondary"
              th:text="${log.actionType}"></span>
        </td>
        <td th:text="${log.actorUserId != null ? log.actorUserId : '-'}"></td>
        <td th:text="${log.targetType + (log.targetId != null ? '#' + log.targetId : '')}"></td>
        <td th:text="${log.ip}"></td>
        <td class="text-truncate" style="max-width:220px;"
            th:text="${log.userAgent}"></td>
        <td class="text-truncate" style="max-width:260px;"
            th:text="${log.diffJson}"></td>
      </tr>

      <tr th:if="${result.totalElements == 0}">
        <td colspan="8" class="text-center text-muted">데이터가 없습니다.</td>
      </tr>
      </tbody>

    </table>
  </div>

  <nav th:if="${result.totalPages > 1}" class="mt-3">
    <ul class="pagination pagination-sm justify-content-center mb-0">

      <li class="page-item" th:classappend="${result.first}? ' disabled'">
        <a class="page-link"
           th:href="@{/admin/audits(page=${result.number-1},action=${action},targetType=${targetType},targetId=${targetId},actorId=${actorId})}">
          이전
        </a>
      </li>

      <li class="page-item"
          th:each="i : ${#numbers.sequence(0, result.totalPages-1)}"
          th:classappend="${i == result.number}? ' active'">
        <a class="page-link"
           th:text="${i+1}"
           th:href="@{/admin/audits(page=${i},action=${action},targetType=${targetType},targetId=${targetId},actorId=${actorId})}">
        </a>
      </li>

      <li class="page-item" th:classappend="${result.last}? ' disabled'">
        <a class="page-link"
           th:href="@{/admin/audits(page=${result.number+1},action=${action},targetType=${targetType},targetId=${targetId},actorId=${actorId})}">
          다음
        </a>
      </li>

    </ul>
  </nav>

</div>
</body>
</html>
